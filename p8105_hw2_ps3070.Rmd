---
title: "p8105_hw2_ps3070"
output: github_document
---

First, I will load the `tidyverse` and `readxl` libraries.

```{r setup, message=FALSE}

library(tidyverse)
library(readxl)
```

## PROBLEM 1

To read and clean the Mr. Trash Wheel .xlsx file, I will:
* import the data
* specify the sheet in the Excel file
* omit non-data entries
* use reasonable variable names
* omit rows that do not include dumpster-specific data
* round the number of sports balls to the nearest integer and converts the result to an integer variable (using `as.integer`)

```{r import trash wheel, message=FALSE}
trashwheel = read_excel(
  "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
  sheet = "Mr. Trash Wheel",
  range = "A2:N408") %>%
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(sports_balls = as.integer(round(sports_balls, digits = 0)))
```

Only cells from A2 to N408 are imported because column O contains notes and row 1 only contains a figure and no data.

To clean up names of the data to snake case, I used `janitor::clean_names()`.

The grand totals are included within the dataset. To omit rows that are dumpster-specific, I omitted rows that included these grand totals. Under the row `dumpster`, I dropped any rows that were recorded as `NA`/without data.


# Reading and Cleaning precipitation data

The 2018 precipitation data has empty rows, so I used `na.omit()` to avoid saving those rows.

```{r}
precip_2017 = read_excel(
  "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
  sheet = 5,
  range = "A2:B14") %>% 
  janitor::clean_names() %>% 
  mutate(year = 2017)

precip_2018 = read_excel(
  "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
  sheet = 4,
  range = "A2:B14") %>% 
  janitor::clean_names() %>% 
  mutate(year = 2018) %>% 
  na.omit(total)

precip = bind_rows(precip_2017, precip_2018) %>% 
  janitor::clean_names() %>% 
  rename(precip_in = total) %>%
  mutate(month = month.name[month])
```

## PROBLEM 2

While importing `pols-month.csv`, I will clean it by doing the following:
* separate `mon` into day, month, and year
* replace month number with month name
* create a `president` variable taking the values of `prez_gop` and `prez_dem`
* remove `prez_gop`, `prez_dem`, and `day`

Columns `prez_gop` and `prez_dem` are removed and consolidated into the column `president`. A column `name` was created to indicate `prez_gop` or `prez_dem`, but it was removed as well because `president` already indicates `0` for `gop` and `1` for `dem`.

```{r clean pols, message = FALSE}
pols = read_csv(file = 
  "./data/pols-month.csv") %>% 
  separate(mon, c("year", "month", "day"), convert = TRUE) %>% 
  mutate(month = month.name[month]) %>% 
  pivot_longer(starts_with("prez"),
               values_to = "president") %>% 
  select(-day, -name) %>% 
  arrange(year, month) %>% 
  select(year, month, everything())
```

Next, I will import and clean `snp.csv` using similar guidelines.

```{r clean snp, message = FALSE}
snp = read_csv(file = 
  "./data/snp.csv") %>% 
  separate(date, c("day", "month", "year"), convert = TRUE) %>% 
  mutate(month = month.name[month]) %>% 
  select(-day) %>% 
  arrange(year, month) %>% 
  select(year, month, everything())
```


Next, I will import and tidy the unemployment data.


```{r clean unemployment, message = FALSE}
unemp = read_csv(file = 
  "./data/unemployment.csv") %>% 
  pivot_longer(cols = Jan:Dec,
               names_to = "month",
               values_to = "rate_unemployed") %>% 
    mutate(month = month.name[match(month, month.abb)]) %>% 
    janitor::clean_names() %>%
    arrange(year, month) %>%
    select(year, month, everything())
```

Next, I will fully join the datasets by merging `snp` into `pols` and merging `unemployment` into the result. I also chose to organize it so that `year`, `month`, and `president` appear before other variables.

```{r merge datasets, message = FALSE}
pols_snp_unemp =
  full_join(full_join(pols, snp, by = c("year", "month")), unemp, by = c("year", "month")) %>% 
  select(year, month, president, everything())
```


##Insert paragraph here!!!

#Date format?

## PROBLEM 3

First, I will load and tidy the data with the following in mind:
* names of a categorical predictor and the case structure of string variables changed over time
* some rows seem duplicated, so I removed using `distinct()`

I removed duplicates first, because it was hard to tell whether counts within other corresponding values of ethnicity (i.e. `BLACK NON HISP` vs `BLACK NON HISPANIC`) were overlapping counts or separate counts. Thus, I removed duplicates before recoding corresponding values as the same value.

##QUESTION: FOR MALE TABLE, DO WE NEED RANK NUMBERS LISTED IN TABLE FOR ONE SINGLE NAME, OR MOST POPULAR NAMES FOR EACH ETHNICITY AND YEAR LISTED IN TABLE?

```{r olivia table, message = FALSE}
baby_names = read_csv(file = "./data/Popular_Baby_Names.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    ethnicity = str_to_lower(ethnicity),
    gender = str_to_lower(gender),
    childs_first_name = str_to_lower(childs_first_name),
    ethnicity = recode(ethnicity, "asian and paci" = "asian and pacific islander",
                       "black non hisp" = "black non hispanic",
                       "white non hisp" = "white non hispanic")) %>% 
  group_by(ethnicity) %>% 
  distinct(.keep_all = FALSE)

baby_names_olivia =
  filter(baby_names, childs_first_name == "olivia") %>% 
  select(-count, -gender,-childs_first_name) %>% 
  pivot_wider(names_from = "year_of_birth",
    values_from = "rank"
  )

knitr::kable(baby_names_olivia, format = "pandoc", caption = "Popularity of Olivia as a Female Baby Name")
```

```{r male baby names, message = FALSE}
baby_names_male =
  filter(baby_names, gender == "male", rank == "1") %>% 
  select(-count, -rank, -gender) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "childs_first_name"
  ) 

knitr::kable(baby_names_male, format = "pandoc", caption = "Most Popular Male Baby Names")
```



```{r scatterplots}
male_scatter =
  filter(baby_names, gender == "male",
         ethnicity == "white non hispanic",
         year_of_birth == "2016") %>% 
  ggplot(aes(x = rank, y = count)) +
  geom_point(aes(color = name)) + 
  labs(
    title = "Rank in Popularity of Male White Non-Hispanic Children Born in 2016",
    x = "Rank",
    y = "Count"
  )
```